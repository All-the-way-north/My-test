# 谷歌测试



## 概述



### 测试应该具备的特点

1. 独立与可重复
2. 能良好地反映被测试代码的结构
3. 测试可移植并且可以大量重复
4. 测试失败的时候能够提供尽可能多的相关信息
5. 应用测试框架

### 基本概念

1. 断言：先编写断言检查条件是否为真的语句

   [^footnote]: 断言的结果有成功、致命失败与非致命失败

   谷歌测试的断言类似于函数调用的宏，当断言失败的时候会打印出断言的源文件的行号信息与失败信息。

   **断言成对出现**

   * ASSERT_*版本产生致命错误，失败时会立即返回，跳过之后的代码（==产生空间泄露==）

   * EXPECT_*产生非致命故障

     ```
     eg:
     
     ASSERT_EQ(x.size(),y.size())<<"Vectors x and y are of unequal length";
     
     for(int i=0;i<x.size();++i)
     EXPECT_EQ(x[i],y[i])<<"Vectors x and y differ at index"<<i;
     
     ```

     

2. 测试套件：包含一或多个测试；每个测试程序包含多个测试套件。

   创建测试：

   1. 使用TEST（）宏定义和命名测试函数，且都是不返回值的C++函数
   2. 函数中与任何有效的C++语句一起都使用谷歌测试的断言来检查值
   3. 测试的结果由断言决定

````c++
TEST(TestSuiteName,TestName) //(测试套件名称，测试名称)
{
...test body...
}
```
````

[^footnote]:`TEST()`函数的第一个参数是测试套件的名称，第二个参数是测试套件中测试的名称；]

[footnote]:两个名称都要是C++标识符，不能包含下划线；

[^footnote]:不同的测试套件的测试可以有相同的单独名称 

```c++
int Factorial(int n);

TEST(FactorialTest,HandlesZeroInput){
EXPECT_EQ(Factorial(0),1);
}

TEST(FactorialTest,HandlsPositiveInput){
EXPECT_EQ(Factorial(1),1);
EXPECT_EQ(Factorial(2),2);
EXPECT_EQ(Factorial(3),6);
EXPECT_EQ(Factorial(8),40320);
}
```

3. 测试夹具：使用相同的数据配置进行多个测试

   创建夹具：

   * 派生一个类：``testing::Test``

   * 类中声明所需对象

   * 编写默认构造或者``SetUp()``函数为测试准备对象

   * 编写析构函数或者``TearDown()``释放``SetUp()``

     ```c++
     TEST_F(TestFixtureClassName,TestName){
     ...test body...
     }
     ```

     [^footnote]:要先定义一个测试夹具类，才可以使用``TEST_F()``

4. 调用测试

   ## VS中搭建谷歌测试框架
   
   1. 打开包含测试代码的解决方案
   
   2. 添加谷歌测试项目
   
   3. 将测试项目的引用添加到待测项目的代码中
   
      ``添加-》引用``
   
      
   
      ### 断言
   
      **添加``#include <gtest/gtest.h>``的头文件**
   
      EXPECT_宏与ASSERT_宏通常成对出现，前者生成非致命错误而后者生成致命错误而中止当前函数，所有断言都支持自定义失败信息
   
      ```c++
      EXPECT_TRUE(my_condition)<<"My condition is not true";
      ```
   
      **断言直接生成成功或失败，而不是测试值或者表达式**
   
      ```c++
      switch(expression){
      case 1:
      ... some checks...
      case 2:
      ...some other checks...
      default:
      FAIL() << "We shouldn't get here";
      }
      ```
   
      [^footnote]:只有测试执行期间无任何断言失败，测试才成功
   
      
   
      ## 概述
      
      
      
      ### 测试应该具备的特点
      
      1. 独立与可重复
      2. 能良好地反映被测试代码的结构
      3. 测试可移植并且可以大量重复
      4. 测试失败的时候能够提供尽可能多的相关信息
      5. 应用测试框架
      
      ***
      
      
      
      ### 命名规范
      
      
      
      #### 文件名
      
      此模块项目名称为ILS_InternationalLanguageModule，即国际化语言字符串的模块。测试编写应用GoogleTest的相关内容，创建GoogleTest项目的时候，用当前模块的项目名加下划线加Test来命名，编写测试的源文件用抽象基类的名称加``.t``命名。以此模块为例，模块项目名称为ILS_InternationalLanguageModule，对应测试项目命名ILS_InternationalLanguageModule_Test，测试项目中的测试源文件以抽象基类命名，即抽象基类头文件ILS_IntLanguageDatabaseAbstract.t.cpp。
      
      #### 基本概念
      
      使用 GoogleTest 时，首先要编写*断言*，*测试*使用断言来验证测试代码的行为，这些断言是检查条件是否为真的语句。GoogleTest用测试套件代替测试用例的说法，测试*套件*包含一个或多个测试，我们希望将测试分组到反映测试代码结构的测试套件中。
      
      GoogleTest 断言是类似于函数调用的宏，可以通过对其行为进行断言来测试类或函数。当断言失败时，GoogleTest 会打印断言的源文件和行号位置以及失败消息。
      
      创建测试：
      
      1.使用`TEST()`宏定义和命名测试函数。这些是不返回值的普通 C++ 函数
      
      2.测试的结果由断言决定,如果测试中的任何断言失败，或者测试崩溃，则整个测试失败,只有在所有的测试都通过才能能算成功
      
      ```
      TEST(测试套件名，测试名称){
      ... 测试的内容 ...
      }
      ```
      
      